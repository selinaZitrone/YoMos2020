---
title: "Clear, reproducible and robust R code"
author: "Sebastian Han√ü and Selina Baldauf"
date: "`r Sys.Date()`"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(knitr)
```

## Workshop overview

### Motivation

* reproducibility
* transparency
* good coding practice

### What will you learn?
* clear project structure
* good programming practice
  + unit testing
  + CI with github Actions
* holepunch
* code on github. [https://github.com/selinaZitrone/YoMos2020](https://github.com/selinaZitrone/YoMos2020)


## Clear project structure

* follow the conventions of your research community / lab
* clear separation of data, method and output
* specify the computational environment
 
* adapt R package stucture for your research compendia

### Advantages

* benefit from quality control mechanisms needed to build your R package (<code>R CMD check</code>)
* writing functions is less error prone
* functions can be easily documented


---

<div class="columns-2">
![Mavick et al. 2018](images/research_compendium.PNG){width=90%}

* other packages generating empty project directory structures: 
  + ProjectTemplate
  + prodigenr
  + workflowr
</div>

## Unit testing {.smaller}

* test individual units of source code to see if it is fit for use 

### Why?

* Fewer bugs
* Better code structure
* Easier to pick up where you left
* Robust code
* You can rerun your tests at anytime to make sure you did not break anything

### How?

* Test external interfaces of functions
* One test for each behaviour
* Test fragile, complicated code
* Write a test if you find a but
* Test-first philosophy: write the test first, then write the code to pass it
* in R: <code>testthat</code> package (Hadley Wickham)

## Continous integration (CI)

> "If it hurts, do it more often" (Martin Fowler)

![](images/pain_vs_time_ci.png){width=30%}

### Idea

* shared code repository (e.g. on github)
* integrate code frequently (every day) to the shared
* automated builds and tests after each commit
* code is only accepted if it builds and passes the test
* everyone can see the results of the lates commit

---

### Why?

* smaller changes are easier to handle
* get quick and frequent feedback
* early bug detection
* constant availability of current code version
* if you have to revert the codebase due to bugs you won't lose that much

* However, can be time consuming and might be overkill for small or solo projects

### How?

* Different tools to set it up
* 

## Github Actions

## Reproducibility and Accessaiility

[Holepunch](https://karthik.github.io/holepunch/)

